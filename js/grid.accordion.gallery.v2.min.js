var grid_accordion={valid_box_selector:"img, video",column_width:0,row_height:0,num_boxes:0,active_box:0,boxes:{},has_videos:false,videos:{},loading_screen:null,image_focused:false,jplayer_class:"jp-player",collapsed_column_class:"collapsed-collumn",collapsed_row_class:"collapsed-row",expanded_column_class:"expanded-column",expanded_row_class:"expanded-row",slideshow_interval:null,options:{width:1024,height:768,full_screen:false,fullscreen_top_offset:0,fullscreen_bottom_offset:0,auto:false,delay:5e3,expanded_width:3,expanded_height:2,num_rows:3,num_columns:4,swf_source:"swf",animate_return:true,resize_inactive_box:true,force_static_move:false,internal_animation_duration:500,animate_internal_images_on_return:true,box_content_scroll_top_offset:0,has_image_thumbnails:true,target:$("#grid-accordion-gallery"),loading_class:"grid-accordion-gallery-loading",body_loading_class:"body-grid-accordion-gallery-loading",body_full_screen_class:"full-screen-grid-accordion-gallery",body_view_port_class:"view-port-grid-accordion-gallery",box_class:"grid-block",box_viewport_class:"grid-block-viewport",box_element_class:"grid-element",box_video_element_class:"grid-video-element",box_thumbnail_class:"grid-element-thumbnail",box_image_class:"grid-element-image",box_content_clone_class:"grid-content-clone",box_content_scroll_class:"grid-content-scrollable"},init:function(e){grid_accordion.set_options(e);if(grid_accordion.options.full_screen){$("body").addClass(grid_accordion.options.body_full_screen_class)}else{$("body").addClass(grid_accordion.options.body_view_port_class)}grid_accordion.create_loading_screen();grid_accordion.create_gallery();grid_accordion.hide_content_boxes();$(window).load(function(){if(grid_accordion.has_videos){grid_accordion.bind_videos()}if(grid_accordion.options.auto){grid_accordion.set_slideshow()}})},set_options:function(e){for(i in e){if(typeof grid_accordion.options[i]!=="undefined"){grid_accordion.options[i]=e[i]}}},run_callback:function(e,t){e(t)},create_loading_screen:function(){$("body").addClass(grid_accordion.options.body_loading_class);grid_accordion.loading_screen=$('<div class="'+grid_accordion.options.loading_class+'" id="'+grid_accordion.options.loading_class+'"></div>');grid_accordion.add_loading_screen()},add_loading_screen:function(){$("body").append(grid_accordion.loading_screen);grid_accordion.set_loading_screen();$(window).load(function(){grid_accordion.hide_loading_screen();grid_accordion.options.target.show()})},set_loading_screen:function(){grid_accordion.loading_screen.css({width:$(window).width()+"px",height:$(window).height()+"px"});$(window).resize(function(){grid_accordion.loading_screen.css({width:$(window).width()+"px",height:$(window).height()+"px"})})},hide_loading_screen:function(){grid_accordion.loading_screen.fadeOut(grid_accordion.options.internal_animation_duration,function(){$("body").removeClass(grid_accordion.options.body_loading_class);grid_accordion.loading_screen.remove()})},create_gallery:function(){grid_accordion.num_boxes=grid_accordion.options.target.find(grid_accordion.valid_box_selector).length-1;grid_accordion.active_box=0;var e=1;var t=1;var n=1;var r="<table><tr>";grid_accordion.options.target.children().each(function(){if($(this).is(grid_accordion.valid_box_selector)){if($(this).is("img")){var t="image"}else if($(this).is("video")){var t="video"}r+='<td type="'+t+'" index="'+grid_accordion.active_box+'" src="'+$(this).attr("src")+'" thumb="'+$(this).attr("thumb")+'" width="'+$(this).attr("width")+'" height="'+$(this).attr("height")+'" content-id="'+$(this).attr("content-id")+'">';r+='<div class="'+grid_accordion.options.box_class+'" index="'+grid_accordion.active_box+'">';r+='<div class="'+grid_accordion.options.box_viewport_class+'">';if($(this).is("img")){r+='<div class="'+grid_accordion.options.box_element_class+'">';if(grid_accordion.options.has_image_thumbnails){r+='<img src="'+$(this).attr("thumb")+'" class="'+grid_accordion.options.box_thumbnail_class+'" />'}r+='<img src="'+$(this).attr("src")+'" class="'+grid_accordion.options.box_image_class+'" />';r+="</div>"}else if($(this).is("video")){r+='<div class="'+grid_accordion.options.box_element_class+" "+grid_accordion.options.box_video_element_class+' jp-video">';r+='<img src="'+$(this).attr("thumb")+'" class="'+grid_accordion.options.box_thumbnail_class+'" />';r+='<div class="jp-type-single">';r+='<div id="jquery_jplayer_'+grid_accordion.active_box+'" class="'+grid_accordion.options.jplayer_class+'"></div>';r+="</div>";r+="</div>"}r+="</div>";r+="</div>";r+="</td>";if(e%grid_accordion.options.num_columns==0&&grid_accordion.active_box<grid_accordion.num_boxes){r+="</tr><tr>"}e++;if(grid_accordion.active_box<grid_accordion.num_boxes){grid_accordion.active_box++}}});r+="</tr></table>";grid_accordion.options.target.html(r);grid_accordion.active_box=0;var e=1;var t=1;var n=1;$("."+grid_accordion.options.box_class).each(function(){var r=$(this);var i=r.parent().attr("type");if(i=="video"){grid_accordion.has_videos=true;grid_accordion.videos[r.parent().attr("index")]={id:"jquery_jplayer_"+r.parent().attr("index"),src:r.parent().attr("src"),thumb:r.parent().attr("thumb"),loaded:false}}var s=r.parent().attr("width");var o=r.parent().attr("height");r.attr("column",t);r.attr("row",n);if(e%grid_accordion.options.num_columns==0){t=1}else{t++}if(e%grid_accordion.options.num_columns==0){n++}e++;grid_accordion.boxes[r.parent().attr("index")]={box:r,type:i,width:s,height:o,content_loaded:false,content_reference:$("#"+r.parent().attr("content-id")),content_clone:null,scroll_loaded:false}});if(grid_accordion.options.full_screen){grid_accordion.set_full_size_gallery();$(window).resize(function(){grid_accordion.set_full_size_gallery()})}else{grid_accordion.set_fixed_gallery()}grid_accordion.set_up_grid()},set_full_size_gallery:function(){grid_accordion.reset_scroll_loaded();grid_accordion.options.target.css({"margin-top":grid_accordion.options.fullscreen_top_offset+"px",width:$(window).width()+"px",height:$(window).height()-grid_accordion.options.fullscreen_top_offset-grid_accordion.options.fullscreen_bottom_offset+"px"});grid_accordion.options.target.find("table").css({width:$(window).width()+"px",height:$(window).height()-grid_accordion.options.fullscreen_top_offset-grid_accordion.options.fullscreen_bottom_offset+"px"})},set_fixed_gallery:function(){grid_accordion.options.target.css({width:grid_accordion.options.width+"px",height:grid_accordion.options.height+"px"})},set_up_grid:function(){grid_accordion.stop_videos();if(grid_accordion.options.full_screen){grid_accordion.set_up_full_screen_grid_sizes(false);$(window).resize(function(){grid_accordion.set_up_full_screen_grid_sizes(false)})}else{grid_accordion.set_up_fixed_grid_sizes(false)}grid_accordion.set_up_grid_hovers()},set_up_full_screen_grid_sizes:function(e){var t=$(window).width();var n=$(window).height();var r=t/grid_accordion.options.num_columns;var i=grid_accordion.options.target.height()/grid_accordion.options.num_rows;grid_accordion.column_width=r;grid_accordion.row_height=i;grid_accordion.set_grid(e,r,i)},set_up_fixed_grid_sizes:function(e){var t=grid_accordion.options.target.width()/grid_accordion.options.num_columns;var n=grid_accordion.options.target.height()/grid_accordion.options.num_rows;grid_accordion.column_width=t;grid_accordion.row_height=n;grid_accordion.set_grid(e,t,n)},set_grid:function(e,t,n){for(box_index in grid_accordion.boxes){if(e){grid_accordion.boxes[box_index].box.parent().stop(true,false).animate({width:t+"px",height:n+"px"},{duration:grid_accordion.options.internal_animation_duration/2,queue:false,complete:function(){}});grid_accordion.boxes[box_index].box.stop(true,false).animate({width:t+"px",height:n+"px"},{duration:grid_accordion.options.internal_animation_duration/2,queue:false,complete:function(){var e=$(this).attr("index");var r=grid_accordion.boxes[e].width/grid_accordion.boxes[e].height;var i=t;var s=i/r;if(s<n){s=n;i=r*s}if(grid_accordion.options.animate_internal_images_on_return){$(this).find("."+grid_accordion.options.box_thumbnail_class).stop(true,true).animate({width:i+"px"},{duration:grid_accordion.options.internal_animation_duration/4,queue:false,complete:function(){}});$(this).find("."+grid_accordion.options.box_image_class).stop(true,true).animate({width:i+"px"},{duration:grid_accordion.options.internal_animation_duration/4,queue:false,complete:function(){}})}else{$(this).find("."+grid_accordion.options.box_thumbnail_class).css({width:i+"px"});$(this).find("."+grid_accordion.options.box_image_class).css({width:i+"px"})}}})}else{var r=grid_accordion.boxes[box_index].width/grid_accordion.boxes[box_index].height;var i=t;var s=i/r;if(s<n){s=n;i=r*s}grid_accordion.boxes[box_index].box.parent().css({width:t+"px",height:n+"px"});grid_accordion.boxes[box_index].box.css({width:t+"px",height:n+"px"});grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.box_thumbnail_class).css({width:i+"px"});grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.box_image_class).css({width:i+"px"})}if(grid_accordion.boxes[box_index].type=="video"){$("#"+grid_accordion.videos[box_index].id).jPlayer("option","size.width",i+"px");$("#"+grid_accordion.videos[box_index].id).jPlayer("option","size.height",s+"px")}}},set_up_grid_hovers:function(){grid_accordion.options.target.hover(function(){},function(){if(grid_accordion.active_box<grid_accordion.num_boxes){grid_accordion.active_box++}else{grid_accordion.active_box=0}grid_accordion.clear_box_classes();grid_accordion.show_box_thumbnails();grid_accordion.hide_generated_content_boxes();grid_accordion.stop_videos();grid_accordion.set_box_classes(grid_accordion.active_box);grid_accordion.move_boxes(true);if(grid_accordion.options.auto){grid_accordion.set_slideshow()}});$("."+grid_accordion.options.box_class).hover(function(){var e=$(this).attr("index");if(grid_accordion.options.auto){grid_accordion.clear_slideshow()}grid_accordion.show_box_thumbnails();grid_accordion.set_box_classes(e);grid_accordion.move_boxes(false);grid_accordion.hide_generated_content_boxes();grid_accordion.set_grid_box_content(e);$(this).find("."+grid_accordion.options.box_thumbnail_class).hide();if(grid_accordion.boxes[e].type=="video"){grid_accordion.process_video();$(this).find("."+grid_accordion.options.jplayer_class).jPlayer("play")}},function(){})},set_box_classes:function(e){grid_accordion.clear_box_classes();var t=grid_accordion.boxes[e].box.attr("column");var n=grid_accordion.boxes[e].box.attr("row");$("."+grid_accordion.options.box_class).not("."+grid_accordion.options.box_class+"[column="+t+"]").addClass(grid_accordion.collapsed_column_class);$("."+grid_accordion.options.box_class).not("."+grid_accordion.options.box_class+"[row="+n+"]").addClass(grid_accordion.collapsed_row_class);$("."+grid_accordion.options.box_class+"[column="+t+"]").addClass(grid_accordion.expanded_column_class);$("."+grid_accordion.options.box_class+"[row="+n+"]").addClass(grid_accordion.expanded_row_class);grid_accordion.active_box=e},clear_box_classes:function(){$("."+grid_accordion.options.box_class).removeClass(grid_accordion.collapsed_column_class);$("."+grid_accordion.options.box_class).removeClass(grid_accordion.collapsed_row_class);$("."+grid_accordion.options.box_class).removeClass(grid_accordion.expanded_column_class);$("."+grid_accordion.options.box_class).removeClass(grid_accordion.expanded_row_class)},move_boxes:function(e){if(e){if(grid_accordion.options.full_screen){grid_accordion.set_up_full_screen_grid_sizes(grid_accordion.options.animate_return)}else{grid_accordion.set_up_fixed_grid_sizes(grid_accordion.options.animate_return)}}else{var t=grid_accordion.options.expanded_width*grid_accordion.column_width;var n=(grid_accordion.options.num_columns-grid_accordion.options.expanded_width)/(grid_accordion.options.num_columns-1)*grid_accordion.column_width;var r=grid_accordion.options.expanded_height*grid_accordion.row_height;var i=(grid_accordion.options.num_rows-grid_accordion.options.expanded_height)/(grid_accordion.options.num_rows-1)*grid_accordion.row_height;if(grid_accordion.options.force_static_move){$("."+grid_accordion.expanded_column_class).parent().css({width:t+"px"});$("."+grid_accordion.expanded_column_class).css({width:t+"px"});$("."+grid_accordion.collapsed_column_class).parent().css({width:n+"px"});$("."+grid_accordion.collapsed_column_class).css({width:n+"px"});$("."+grid_accordion.expanded_row_class).parent().css({height:r+"px"});$("."+grid_accordion.expanded_row_class).css({height:r+"px"});$("."+grid_accordion.collapsed_row_class).css({height:i+"px"});$("."+grid_accordion.collapsed_row_class).parent().css({height:i+"px"})}else{$("."+grid_accordion.expanded_column_class).parent().animate({width:t+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.expanded_column_class).animate({width:t+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.collapsed_column_class).parent().animate({width:n+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.collapsed_column_class).animate({width:n+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.expanded_row_class).parent().animate({height:r+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.expanded_row_class).animate({height:r+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.collapsed_row_class).parent().animate({height:i+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}});$("."+grid_accordion.collapsed_row_class).animate({height:i+"px"},{duration:grid_accordion.options.internal_animation_duration,queue:false,complete:function(){}})}for(box_index in grid_accordion.boxes){var s=grid_accordion.boxes[box_index].width/grid_accordion.boxes[box_index].height;var o=t;if(grid_accordion.options.resize_inactive_box){if(grid_accordion.boxes[box_index].box.hasClass(grid_accordion.collapsed_column_class)){o=n}}var u=o/s;if(grid_accordion.boxes[box_index].box.hasClass(grid_accordion.expanded_row_class)){if(u<r){u=r;o=s*u}}else{if(u<i){u=i;o=s*u}}grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.box_image_class).css({width:o+"px"});grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.box_thumbnail_class).css({width:o+"px"});if(grid_accordion.boxes[box_index].type=="video"){grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.jplayer_class).jPlayer("option","size.width",o+"px");grid_accordion.boxes[box_index].box.find("."+grid_accordion.options.jplayer_class).jPlayer("option","size.height",u+"px")}}}},show_box_thumbnails:function(){$("."+grid_accordion.options.box_thumbnail_class).show()},hide_box_thumbnails:function(){$("."+grid_accordion.options.box_thumbnail_class).hide()},bind_videos:function(){for(i in grid_accordion.videos){$("#"+grid_accordion.videos[i].id).jPlayer({loop:true,swfPath:grid_accordion.options.swf_source,supplied:"flv",solution:"html, flash"})}if(grid_accordion.options.full_screen){$(window).trigger("resize")}else{grid_accordion.set_up_fixed_grid_sizes()}},process_video:function(){grid_accordion.stop_videos();if(typeof grid_accordion.videos[grid_accordion.active_box]!=="undefined"){if(!grid_accordion.videos[grid_accordion.active_box].loaded){$("#"+grid_accordion.videos[grid_accordion.active_box].id).jPlayer("setMedia",{flv:grid_accordion.videos[grid_accordion.active_box].src});grid_accordion.videos[grid_accordion.active_box].loaded=true}grid_accordion.boxes[grid_accordion.active_box].box.find("."+grid_accordion.options.box_thumbnail_class).hide();$("#"+grid_accordion.videos[grid_accordion.active_box].id).jPlayer("play")}},stop_videos:function(){grid_accordion.show_box_thumbnails();for(i in grid_accordion.videos){$("#"+grid_accordion.videos[i].id).jPlayer("stop")}},set_slideshow:function(){grid_accordion.slideshow_interval=setInterval(function(){grid_accordion.set_slideshow_interval()},grid_accordion.options.delay)},set_slideshow_interval:function(){grid_accordion.set_box_classes(grid_accordion.active_box);grid_accordion.show_box_thumbnails();grid_accordion.stop_videos();grid_accordion.hide_generated_content_boxes();grid_accordion.set_grid_box_content(grid_accordion.active_box);grid_accordion.move_boxes(false);grid_accordion.boxes[grid_accordion.active_box].box.find("."+grid_accordion.options.box_thumbnail_class).hide();if(grid_accordion.boxes[grid_accordion.active_box].type=="video"){grid_accordion.process_video();grid_accordion.boxes[grid_accordion.active_box].box.find("."+grid_accordion.options.jplayer_class).jPlayer("play")}if(grid_accordion.active_box<grid_accordion.num_boxes){grid_accordion.active_box++}else{grid_accordion.active_box=0}},clear_slideshow:function(){clearInterval(grid_accordion.slideshow_interval);grid_accordion.clear_box_classes();grid_accordion.show_box_thumbnails();grid_accordion.stop_videos()},hide_content_boxes:function(){for(box_index in grid_accordion.boxes){grid_accordion.boxes[box_index].content_reference.hide()}},hide_generated_content_boxes:function(){for(box_index in grid_accordion.boxes){if(grid_accordion.boxes[box_index].content_clone!=null&&grid_accordion.boxes[box_index].content_loaded){grid_accordion.boxes[box_index].content_clone.hide()}}},set_grid_box_content:function(e){if(!grid_accordion.boxes[e].content_loaded&&grid_accordion.boxes[e].content_clone==null){grid_accordion.boxes[e].content_clone=grid_accordion.boxes[e].content_reference.clone().removeAttr("id").addClass(grid_accordion.options.box_content_clone_class);grid_accordion.boxes[e].box.append(grid_accordion.boxes[e].content_clone);grid_accordion.boxes[e].content_loaded=true}else{grid_accordion.boxes[e].box.append(grid_accordion.boxes[e].content_clone)}grid_accordion.boxes[e].content_clone.show();var t=grid_accordion.boxes[e].content_clone.find("."+grid_accordion.options.box_content_scroll_class);if(t.length&&!grid_accordion.boxes[e].scroll_loaded){var n=grid_accordion.options.expanded_width*grid_accordion.column_width;var r=grid_accordion.options.expanded_height*grid_accordion.row_height;t.css({width:n+"px",height:r-grid_accordion.options.box_content_scroll_top_offset+"px"});t.jScrollPane({autoReinitialise:true});grid_accordion.boxes[e].scroll_loaded=true}},reset_scroll_loaded:function(){for(box_index in grid_accordion.boxes){grid_accordion.boxes[box_index].scroll_loaded=false}grid_accordion.hide_generated_content_boxes()}}